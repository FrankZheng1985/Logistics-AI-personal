# 小析2微信监控 - 完整安装指南

> 📱 让小析2监控微信群，自动提取物流线索和行业情报

---

## 📊 你的设备信息

- **电脑**: iMac (Retina 5K, 27-inch, Late 2014)
- **处理器**: Intel Core i7 (4核 4GHz)
- **内存**: 16 GB ✅ 足够
- **系统**: macOS Big Sur 11.7.10

---

## 🎯 安装流程总览

| 步骤 | 内容 | 时间 | 难度 |
|-----|------|------|-----|
| 1️⃣ | 下载VirtualBox | 5分钟 | ⭐ |
| 2️⃣ | 安装VirtualBox | 10分钟 | ⭐ |
| 3️⃣ | 下载Windows镜像 | 20分钟 | ⭐ |
| 4️⃣ | 创建虚拟机 | 15分钟 | ⭐⭐ |
| 5️⃣ | 安装Windows | 30分钟 | ⭐ |
| 6️⃣ | 安装微信+WeChatFerry | 20分钟 | ⭐⭐ |
| 7️⃣ | 配置网络连接 | 10分钟 | ⭐⭐ |

**总计约 2 小时**

---

## 1️⃣ 下载 VirtualBox

### 下载链接

打开浏览器，访问：
```
https://www.virtualbox.org/wiki/Downloads
```

如果官网打不开，备用下载：
```
https://download.virtualbox.org/virtualbox/7.1.4/VirtualBox-7.1.4-165100-OSX.dmg
```

或者用国内镜像：
```
https://mirrors.tuna.tsinghua.edu.cn/virtualbox/
```

### 选择版本
- 点击 **"macOS / Intel hosts"**
- 下载 `.dmg` 文件（约 130MB）

---

## 2️⃣ 安装 VirtualBox

### 步骤：

1. **双击打开** 下载的 `.dmg` 文件

2. **双击 VirtualBox.pkg** 开始安装

3. **遇到安全提示时**：
   - 点击 **"打开系统偏好设置"**
   - 点击左下角 🔒 解锁
   - 点击 **"允许"** 按钮
   
4. **继续安装**，点击 "继续" → "安装"

5. **输入Mac密码** 确认安装

6. **安装完成**！在启动台找到 VirtualBox 图标

### ⚠️ 常见问题

**Q: 提示"系统扩展被阻止"？**
A: 
1. 打开 **系统偏好设置 → 安全性与隐私**
2. 点击左下角 🔒 解锁
3. 点击 **"允许"** Oracle 的软件

---

## 3️⃣ 下载 Windows 10 镜像

### 下载链接

打开浏览器，访问微软官网：
```
https://www.microsoft.com/zh-cn/software-download/windows10ISO
```

### 步骤：

1. 在页面选择 **"Windows 10"**
2. 点击 **"确认"**
3. 选择语言：**简体中文**
4. 点击 **"确认"**
5. 点击 **"64-bit 下载"**
6. 等待下载完成（约 5GB）

### 💡 小技巧
下载时间较长，可以先做其他事情

---

## 4️⃣ 创建 Windows 虚拟机

### 打开 VirtualBox

1. 点击启动台中的 **VirtualBox** 图标
2. 点击左上角 **"新建"** 按钮

### 基本设置

在弹出窗口中填写：

| 项目 | 填写内容 |
|-----|---------|
| 名称 | `Windows10-微信监控` |
| 文件夹 | 保持默认 |
| ISO镜像 | 点击选择刚下载的Windows ISO文件 |
| 类型 | Microsoft Windows |
| 版本 | Windows 10 (64-bit) |
| ☑️ 跳过自动安装 | **勾选** |

点击 **"下一步"**

### 内存和CPU设置

| 项目 | 推荐设置 | 说明 |
|-----|---------|------|
| 内存 | **6144 MB** (6GB) | 你有16GB，给虚拟机6GB |
| CPU | **2 核** | 4核给虚拟机2核 |

点击 **"下一步"**

### 虚拟硬盘设置

| 项目 | 推荐设置 |
|-----|---------|
| 硬盘大小 | **60 GB** |
| 类型 | VDI |
| 动态分配 | ✅ 是 |

点击 **"下一步"** → **"完成"**

---

## 5️⃣ 安装 Windows

### 启动虚拟机

1. 在VirtualBox主界面，选中刚创建的虚拟机
2. 点击 **"启动"** 按钮
3. 虚拟机窗口打开，开始从ISO启动

### Windows 安装步骤

1. **语言设置**
   - 语言：中文（简体）
   - 时间：中国
   - 键盘：微软拼音
   - 点击 **"下一步"**

2. **点击 "现在安装"**

3. **产品密钥**
   - 点击 **"我没有产品密钥"**（可以先不激活）

4. **选择版本**
   - 选择 **"Windows 10 专业版"**
   - 点击 **"下一步"**

5. **接受许可条款**
   - ☑️ 勾选同意
   - 点击 **"下一步"**

6. **安装类型**
   - 选择 **"自定义：仅安装Windows"**

7. **选择硬盘**
   - 选择 "驱动器0 未分配空间"
   - 点击 **"下一步"**

8. **等待安装**
   - 大约需要 20-30 分钟
   - 期间会自动重启几次

9. **初始设置**
   - 地区：中国
   - 键盘：微软拼音
   - 跳过第二键盘
   - 选择"针对个人使用进行设置"
   - 选择"脱机帐户"
   - 用户名：`admin`
   - 密码：自己设置（可以不设）
   - 隐私设置：全部关闭
   - 跳过Cortana

10. **完成！** 进入Windows桌面

---

## 6️⃣ 安装微信 + WeChatFerry

### 在Windows虚拟机中操作：

### 6.1 安装 PC 版微信

1. 打开 Edge 浏览器
2. 访问：`https://weixin.qq.com/`
3. 点击 **"下载"** → **"Windows"**
4. 双击安装包安装
5. **重要**：安装时记住安装路径（默认是 `C:\Program Files\Tencent\WeChat`）

### 6.2 下载 WeChatFerry

1. 访问：`https://github.com/lich0821/WeChatFerry/releases`
2. 找到最新版本
3. 下载 `wcferry.zip` 和 `wcf-http.zip`
4. 解压到 `C:\WeChatFerry\` 文件夹

### 6.3 检查微信版本兼容性

WeChatFerry 对微信版本有要求，查看 GitHub 页面说明：
- 如果版本不兼容，需要下载指定版本的微信
- 下载地址通常在 WeChatFerry 的 README 中

### 6.4 启动 WeChatFerry

1. **先启动微信**，但不要登录
2. **运行 WeChatFerry**
   - 双击 `wcf-http.exe`
   - 或在命令行运行：
   ```cmd
   cd C:\WeChatFerry
   wcf-http.exe --port 10086
   ```
3. **在微信上扫码登录**
4. 看到控制台显示 **"微信已登录"** 表示成功！

### 6.5 测试 API

在浏览器访问：
```
http://localhost:10086/api/status
```

如果返回类似这样的JSON，说明成功：
```json
{
  "is_login": true,
  "wxid": "wxid_xxxxx"
}
```

---

## 7️⃣ 配置网络连接

### 目标
让你的服务器（Render）能访问虚拟机中的 WeChatFerry

### 7.1 VirtualBox 网络设置

1. 关闭虚拟机
2. 在VirtualBox中选中虚拟机 → 设置 → 网络
3. 网卡1 设置：
   - 连接方式：**桥接网卡**
   - 名称：选择你Mac的网卡（通常是 en0 或 Wi-Fi）
4. 点击 "确定"

### 7.2 获取虚拟机IP

1. 启动虚拟机
2. 在Windows中打开命令提示符（Win+R，输入cmd）
3. 输入：
   ```cmd
   ipconfig
   ```
4. 找到 IPv4 地址，例如：`192.168.1.105`

### 7.3 配置防火墙

在Windows中：
1. 搜索 "Windows Defender 防火墙"
2. 点击 "高级设置"
3. 点击 "入站规则" → "新建规则"
4. 规则类型：端口
5. 协议：TCP，端口：10086
6. 操作：允许连接
7. 名称：WeChatFerry

### 7.4 测试远程访问

在Mac上打开浏览器，访问：
```
http://192.168.1.105:10086/api/status
```
（把IP换成你虚拟机的实际IP）

如果能访问，说明配置成功！

### 7.5 配置端口映射（如果需要外网访问）

如果你的服务器在云端（如Render），需要：

**方案A：使用内网穿透工具**
- 推荐：ngrok、frp、花生壳
- 把 10086 端口映射到公网

**方案B：使用固定IP**
- 如果你有公网IP，直接在路由器上做端口映射

---

## 8️⃣ 配置系统连接

### 修改后端配置

在你的项目中，修改 `.env` 或配置文件：

```env
# WeChatFerry 配置
WCF_API_URL=http://192.168.1.105:10086
```

如果使用了内网穿透，改成穿透后的地址：
```env
WCF_API_URL=https://your-tunnel.ngrok.io
```

### 重启后端服务

```bash
# 本地测试
cd backend
python -m uvicorn app.main:app --reload
```

---

## 9️⃣ 设置开机自启

### Windows 虚拟机自启微信和WeChatFerry

1. 按 `Win+R`，输入 `shell:startup`，回车
2. 创建一个 `start.bat` 文件：
   ```bat
   @echo off
   start "" "C:\Program Files\Tencent\WeChat\WeChat.exe"
   timeout /t 5
   start "" "C:\WeChatFerry\wcf-http.exe" --port 10086
   ```
3. 把这个文件放到启动文件夹

### Mac 上 VirtualBox 虚拟机自启

1. 创建一个 AppleScript：
   ```applescript
   tell application "VirtualBox"
       launch
       delay 5
   end tell
   do shell script "VBoxManage startvm 'Windows10-微信监控' --type headless"
   ```
2. 保存为 `启动微信监控.app`
3. 添加到 **系统偏好设置 → 用户与群组 → 登录项**

---

## ✅ 完成检查清单

- [ ] VirtualBox 安装成功
- [ ] Windows 虚拟机创建成功
- [ ] Windows 安装完成
- [ ] 微信 PC 版安装成功
- [ ] WeChatFerry 下载并解压
- [ ] 微信登录成功
- [ ] WeChatFerry 启动成功
- [ ] API 测试正常
- [ ] 网络配置完成
- [ ] 从Mac可以访问虚拟机的API
- [ ] 后端配置更新
- [ ] 开机自启设置（可选）

---

## ❓ 常见问题

### Q1: VirtualBox 安装后打不开？
A: 去 **系统偏好设置 → 安全性与隐私 → 通用**，点击 "允许" Oracle 的软件

### Q2: Windows 安装很慢？
A: 正常，第一次安装需要 20-30 分钟，耐心等待

### Q3: WeChatFerry 提示版本不兼容？
A: 需要下载指定版本的微信，查看 WeChatFerry GitHub 上的说明

### Q4: Mac 无法访问虚拟机的 API？
A: 检查：
1. 虚拟机网络是否设置为"桥接模式"
2. Windows 防火墙是否放行 10086 端口
3. IP 地址是否正确

### Q5: 重启后微信掉线？
A: 微信PC版重启后需要重新扫码登录，建议：
1. 设置微信"登录后自动启动"
2. 保持手机和电脑在同一网络

---

## 📞 需要帮助？

如果遇到问题，截图发给我，我来帮你解决！

---

*最后更新：2026年1月15日*
